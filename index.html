<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMAIL SHOP ü©≥</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #FF8C00;
            --primary-light: #ffaf58;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --bg-light: #f8f9fa;
            --card-bg: #ffffff;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-light); 
            color: var(--text-dark);
        }

        /* --- Premium Card Style --- */
        .premium-card {
            background-color: var(--card-bg);
            border-radius: 1.25rem; /* 20px */
            padding: 1.5rem; /* 24px */
            box-shadow: 0 10px 30px -5px rgba(31, 41, 55, 0.08);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .premium-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px -10px rgba(31, 41, 55, 0.12);
        }
        
        /* --- Text & Gradients --- */
        .text-accent-gradient {
            background: linear-gradient(45deg, var(--primary-light), var(--primary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* --- Buttons --- */
        .btn-gradient { 
            background-image: linear-gradient(45deg, var(--primary-light), var(--primary-color));
            color: white; 
            font-weight: 600; 
            border-radius: 0.75rem; /* 12px */
            padding: 0.875rem 1.5rem; /* 14px 24px */
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.25);
            transition: all 0.3s ease;
            transform: scale(1);
        }
        .btn-gradient:hover {
            box-shadow: 0 8px 25px rgba(255, 140, 0, 0.35);
            transform: scale(1.03);
        }
        .btn-gradient:active {
            transform: scale(0.98);
            box-shadow: 0 2px 10px rgba(255, 140, 0, 0.2);
        }
        .btn-gradient:disabled, .btn-disabled { 
            background-image: none;
            background-color: #e5e7eb; 
            color: #9ca3af; 
            cursor: not-allowed; 
            box-shadow: none;
        }

        /* --- Input Fields --- */
        .input-field { 
            background-color: #f3f4f6; 
            border: 2px solid transparent; 
            color: var(--text-dark);
            border-radius: 0.75rem;
            padding: 0.875rem;
            transition: all 0.2s ease;
        }
        .input-field:focus {
            border-color: var(--primary-color);
            background-color: white;
            box-shadow: 0 0 0 3px rgba(255, 140, 0, 0.2);
            outline: none;
        }

        /* --- Page & Animations --- */
        .main-page.active { display: block; }
        .sub-page { display: none; }
        .sub-page.active { display: block; animation: slideInUpFade 0.6s cubic-bezier(0.16, 1, 0.3, 1); }

        @keyframes slideInUpFade {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-on-load {
            animation: slideInUpFade 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0;
        }
        
        /* --- Bottom Navigation --- */
        .bottom-nav {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            right: 1rem;
            max-width: calc(100% - 2rem);
            margin: 0 auto;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0.5rem; /* 8px */
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 999px;
            box-shadow: 0 10px 40px -10px rgba(31, 41, 55, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.9);
            z-index: 50;
        }
        .nav-link-premium { 
            display: flex; 
            align-items: center; 
            justify-content: center;
            gap: 8px; 
            color: var(--text-light); 
            font-size: 0.875rem; /* 14px */
            font-weight: 600; 
            padding: 0.625rem 1rem; /* 10px 16px */
            border-radius: 999px; 
            transition: all 0.3s ease; 
            position: relative; 
        }
        .nav-link-premium .icon { width: 22px; height: 22px; }
        .nav-link-premium .nav-text { display: none; } /* Hide text by default */

        .nav-link-premium.active { 
            color: white;
            background-image: linear-gradient(45deg, var(--primary-light), var(--primary-color));
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.25);
        }
        .nav-link-premium.active .nav-text { display: inline; }

        .center-home-link { 
            background: linear-gradient(45deg, var(--primary-light), var(--primary-color));
            border-radius: 50%; 
            width: 64px; 
            height: 64px;
            display: flex; align-items: center; justify-content: center; 
            box-shadow: 0 8px 25px rgba(255, 140, 0, 0.35); 
            transition: all 0.3s ease; 
            color: white; 
            transform: translateY(-25px);
        }
        .center-home-link:hover { transform: translateY(-25px) scale(1.08); }
        .center-home-link .icon { width: 32px; height: 32px; }
        
        /* --- Loader --- */
        #loader {
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            inset: 0;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 100;
        }
        .spinner {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            padding: 6px;
            background: conic-gradient(from 180deg at 50% 50%, rgba(255, 255, 255, 0) 0deg, var(--primary-color) 360deg),
                        linear-gradient(100deg, var(--primary-light) 0%, var(--primary-color) 100%);
            animation: spin 1.2s linear infinite;
        }
        .spinner::before {
            content: '';
            display: block;
            width: 100%;
            height: 100%;
            background: var(--bg-light);
            border-radius: 50%;
        }
        @keyframes spin { to { transform: rotate(1turn); } }

        /* --- Review Section --- */
        .reviews-container {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 0.25rem 1rem 1rem 1rem;
            margin: 0 -1rem;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .reviews-container::-webkit-scrollbar { display: none; }
        .review-card {
            flex: 0 0 280px;
            background-color: var(--card-bg);
            border-radius: 1rem;
            padding: 1.25rem;
            box-shadow: 0 4px 20px -5px rgba(31, 41, 55, 0.06);
        }
        .star-rating i { color: #facc15; }
        
        /* --- Header --- */
        .header {
            background-color: rgba(248, 249, 250, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid #e5e7eb;
        }

        /* --- New Tutorial Section --- */
        .tutorial-card {
            background-color: var(--card-bg);
            border-radius: 1.25rem;
            padding: 1rem;
            box-shadow: 0 4px 20px -5px rgba(31, 41, 55, 0.06);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .tutorial-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 10px 30px -10px rgba(31, 41, 55, 0.1);
        }
        .tutorial-card .thumbnail-container {
            flex-shrink: 0;
            width: 120px;
            height: 75px;
            position: relative;
            border-radius: 0.75rem;
            overflow: hidden;
            background-color: #e5e7eb;
        }
        .tutorial-card .thumbnail-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .tutorial-card .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }
        .tutorial-card:hover .play-icon {
            transform: translate(-50%, -50%) scale(1.1);
        }
        .tutorial-card .tutorial-info h3 {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }
        .tutorial-card .tutorial-info p {
            font-size: 0.875rem;
            color: var(--text-light);
        }

    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
    </div>

    <div id="app-container" class="max-w-md mx-auto min-h-screen hidden main-page">
        <header class="header flex items-center justify-between p-4 sticky top-0 z-40">
            <h1 class="text-xl font-bold text-accent-gradient">GMAIL SHOP</h1>
            <div id="header-balance-display" class="font-bold text-lg text-gray-700">‡ß≥0.00</div>
        </header>

        <main class="flex-grow pb-28">
            <div id="home-page" class="p-4 space-y-6 sub-page">
                <div class="rounded-2xl overflow-hidden shadow-lg">
                    <div class="relative w-full pt-[56.25%]">
                        <div id="slides" class="absolute top-0 left-0 w-full h-full flex transition-transform duration-700 ease-in-out">
                            <div class="slide min-w-full"><a href="https://t.me/EXPERTearn_team" target="_blank"><img src="https://i.postimg.cc/zBp8rCX9/Yellow-Orange-Modern-Marketing-Courses-You-Tube-Thumbnail-20250910-185659-0000.png" alt="Slide 1" class="w-full h-full object-cover"></a></div>
                            <div class="slide min-w-full"><a href="https://t.me/EXPERTearn_team" target="_blank"><img src="https://i.postimg.cc/W1syFD8p/Grey-Blue-Illustration-Refer-a-Friend-Instagram-Post-1080-x-720-px-20250917-223749-0000.png" alt="Slide 2" class="w-full h-full object-cover"></a></div>
                            <div class="slide min-w-full"><a href="https://t.me/EXPERTearn_team" target="_blank"><img src="https://i.postimg.cc/52HsFwvV/Black-and-Orange-Money-You-Tube-Thumbnail-20250917-224706-0000.png" alt="Slide 3" class="w-full h-full object-cover"></a></div>
                        </div>
                        <div id="dots" class="absolute bottom-3 w-full text-center z-10"></div>
                    </div>
                </div>
                
                <div class="premium-card">
                    <p class="text-gray-500 text-sm font-medium mb-1">Your Balance</p>
                    <div class="flex items-center justify-between">
                        <p id="balance-display" class="text-4xl font-bold text-gray-800">‡ß≥0.00</p>
                        <button id="home-deposit-btn" class="btn-gradient px-6 py-2 rounded-lg text-sm">Deposit</button>
                    </div>
                </div>

                <section>
                    <h2 class="text-lg font-bold px-4 mb-3 text-gray-800">Customer Reviews</h2>
                    <div class="reviews-container">
                        <div class="review-card">
                            <div class="flex items-center mb-3">
                                <img src="https://i.pravatar.cc/150?u=a042581f4e29026704d" class="w-10 h-10 rounded-full mr-3" alt="Avatar">
                                <div>
                                    <p class="font-semibold text-gray-800">Rahim Hasan</p>
                                    <div class="star-rating flex text-sm"><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i></div>
                                </div>
                            </div>
                            <p class="text-gray-600 text-sm">‡¶Ü‡¶™‡¶®‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ö‡¶®‡ßá‡¶ï ‡¶≠‡¶æ‡¶≤‡ßã‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶∏‡¶¨‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ü‡¶™‡¶®‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ï‡¶ø‡¶®‡¶ø ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶Ü‡¶™‡¶®‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Æ‡ßá‡¶á‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ö‡¶®‡ßá‡¶ï ‡¶≠‡¶æ‡¶≤‡ßã ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶ì ‡¶ö‡¶Æ‡ßé‡¶ï‡¶æ‡¶∞‡•§</p>
                        </div>
                        <div class="review-card">
                            <div class="flex items-center mb-3">
                                <img src="https://i.pravatar.cc/150?u=a042581f4e29026704e" class="w-10 h-10 rounded-full mr-3" alt="Avatar">
                                <div>
                                    <p class="font-semibold text-gray-800">Anika Tabassum</p>
                                    <div class="star-rating flex text-sm"><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i></div>
                                </div>
                            </div>
                            <p class="text-gray-600 text-sm">Best mail service I've used. Fast delivery and all accounts are 100% working. Highly recommended!</p>
                        </div>
                        <div class="review-card">
                            <div class="flex items-center mb-3">
                                <img src="https://i.pravatar.cc/150?u=a042581f4e29026704f" class="w-10 h-10 rounded-full mr-3" alt="Avatar">
                                <div>
                                    <p class="font-semibold text-gray-800">Siyam Ahmed</p>
                                    <div class="star-rating flex text-sm"><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i><i data-lucide="star" class="w-4 h-4 fill-current"></i></div>
                                </div>
                            </div>
                            <p class="text-gray-600 text-sm">‡¶ñ‡ßÅ‡¶¨ ‡¶∏‡¶π‡¶ú‡ßá ‡¶è‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ï‡ßá‡¶®‡¶æ ‡¶Ø‡¶æ‡ßü‡•§ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡¶ì ‡¶Ö‡¶®‡ßá‡¶ï ‡¶∏‡¶π‡¶ú‡•§ ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶ GMAIL SHOP‡•§</p>
                        </div>
                    </div>
                </section>
            </div>
            
            <div id="pay-page" class="p-4 space-y-6 sub-page">
                <h2 class="text-2xl font-bold text-center text-gray-800">Pay Center</h2>
                 <div class="premium-card space-y-5">
                    <div>
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold text-lg flex items-center gap-2"><i data-lucide="wallet" class="w-6 h-6 text-primary-color"></i><span>Make a Deposit</span></h3>
                            <button id="deposit-details-btn" class="text-sm font-semibold text-primary-color">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</button>
                        </div>
                        <p class="text-md font-semibold text-gray-700 mb-4 text-center p-3 rounded-xl border-2 border-dashed border-yellow-400 bg-yellow-50">‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá <span class="text-yellow-600 animate-pulse">‡¶∏‡ßá‡¶®‡ßç‡¶°‡¶Æ‡¶æ‡¶®‡¶ø</span> ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                        <div class="grid grid-cols-2 gap-4 mb-5">
                            <div class="bg-gray-100 p-3 rounded-lg text-center"><img src="https://i.postimg.cc/Jh9s6jWw/20250922-113350.png" alt="Nagad" class="w-10 h-10 rounded-full mx-auto mb-2"><p class="font-bold text-md text-gray-700">‡¶®‡¶ó‡¶¶</p><p class="text-gray-600 font-mono tracking-wider text-sm my-1">01864260513</p><button onclick="copyToClipboard('01864260513', this)" class="w-full text-xs p-2 mt-1 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors flex items-center justify-center gap-1 font-semibold text-gray-600"><i data-lucide="copy" class="w-3 h-3"></i><span>Copy</span></button></div>
                            <div class="bg-gray-100 p-3 rounded-lg text-center"><img src="https://i.postimg.cc/tCwGVkdH/20250922-113514.png" alt="bKash" class="w-10 h-10 rounded-full mx-auto mb-2"><p class="font-bold text-md text-gray-700">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</p><p class="text-gray-600 font-mono tracking-wider text-sm my-1">01827750260</p><button onclick="copyToClipboard('01827750260', this)" class="w-full text-xs p-2 mt-1 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors flex items-center justify-center gap-1 font-semibold text-gray-600"><i data-lucide="copy" class="w-3 h-3"></i><span>Copy</span></button></div>
                        </div>
                        <p class="text-sm text-gray-500 mb-4 text-center border-t border-gray-200 pt-4">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶™‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶´‡¶∞‡ßç‡¶Æ‡¶ü‡¶ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®:</p>
                        <div class="space-y-4">
                             <div><label for="deposit-method" class="block text-sm font-medium text-gray-600 mb-2">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ</label><select id="deposit-method" class="w-full input-field"><option value="">‡¶ï‡ßã‡¶® ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®?</option><option value="Nagad">‡¶®‡¶ó‡¶¶</option><option value="bKash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option></select></div>
                            <div><label for="deposit-amount" class="block text-sm font-medium text-gray-600 mb-2">‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (BDT)</label><input id="deposit-amount" type="number" placeholder="e.g., 100" class="w-full input-field"></div>
                            <div><label for="sender-number" class="block text-sm font-medium text-gray-600 mb-2">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label><input id="sender-number" type="text" placeholder="‡¶Ø‡ßá ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®" class="w-full input-field"></div>
                            <div><label for="deposit-txid" class="block text-sm font-medium text-gray-600 mb-2">Transaction ID (TrxID)</label><input id="deposit-txid" type="text" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶™‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ TrxID" class="w-full input-field"></div>
                            <button id="deposit-btn" class="w-full btn-gradient">Submit Deposit</button>
                        </div>
                    </div>
                </div>
                <div class="mt-6"><h3 class="text-lg font-bold mb-3">Payment History</h3><div id="payment-history-list" class="space-y-3"></div></div>
            </div>

            <div id="mail-page" class="p-4 space-y-6 sub-page">
                <h2 class="text-2xl font-bold text-center text-gray-800">GMAIL SHOP</h2>
                <p class="text-gray-500 text-center -mt-4 mb-4">‡¶ï‡¶Æ ‡¶¶‡¶æ‡¶Æ‡ßá ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶π‡¶ú‡ßá ‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</p>
                <div id="mail-list" class="space-y-4"></div>
                 <div>
                    <div class="flex justify-between items-center mb-3 mt-6"><h3 class="text-lg font-bold">Purchase History</h3><button id="download-history-btn" class="text-sm font-semibold text-primary-color flex items-center gap-2"><i data-lucide="download" class="w-4 h-4"></i><span>Download</span></button></div>
                    <div id="mail-purchase-history" class="space-y-3"></div>
                </div>
            </div>

            <div id="updates-page" class="p-4 space-y-6 sub-page">
                <h2 class="text-2xl font-bold text-center text-gray-800">Latest Updates</h2>
                <div id="updates-content" class="space-y-4"><p class="text-center text-gray-500">Loading updates...</p></div>
            </div>
            
            <div id="tutorial-page" class="p-4 space-y-6 sub-page">
                <h2 class="text-2xl font-bold text-center text-gray-800">Tutorials</h2>
                <p class="text-gray-500 text-center -mt-4 mb-4">‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</p>
                <div id="tutorial-list" class="space-y-4">
                    </div>
            </div>

            <div id="profile-page" class="p-4 space-y-6 sub-page">
                <div class="premium-card">
                    <div class="flex flex-col items-center text-center">
                        <div class="relative mb-4">
                            <img id="profile-pic" class="w-28 h-28 rounded-full border-4 border-white object-cover shadow-lg" src="" alt="Profile Picture">
                            <div id="profile-initials-avatar" class="w-28 h-28 rounded-full bg-gray-700 flex items-center justify-center border-4 border-white shadow-lg"><span id="profile-initials" class="text-4xl font-bold text-gray-300"></span></div>
                        </div>
                        <h3 id="profile-name" class="text-2xl font-bold text-gray-800">Loading...</h3>
                        <p id="profile-username" class="text-gray-500">@username</p>
                        <p id="profile-id" class="text-sm text-gray-500 mt-2 bg-gray-100 px-3 py-1 rounded-full font-medium">ID: 123456</p>
                    </div>

                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h4 class="text-sm font-bold text-gray-400 uppercase tracking-wider text-center mb-4">Account Summary</h4>
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div>
                                <p id="profile-total-deposit" class="text-2xl font-bold text-green-500">‡ß≥0</p>
                                <p class="text-xs text-gray-500 font-medium">Total Deposit</p>
                            </div>
                            <div>
                                <p id="profile-total-spent" class="text-2xl font-bold text-red-500">‡ß≥0</p>
                                <p class="text-xs text-gray-500 font-medium">Total Spent</p>
                            </div>
                            <div>
                                <p id="profile-mails-purchased" class="text-2xl font-bold text-blue-500">0</p>
                                <p class="text-xs text-gray-500 font-medium">Mails Bought</p>
                            </div>
                        </div>
                    </div>
                </div>
                 <div class="text-center pt-6">
                    <p class="text-center text-gray-400 text-sm">Developed by <a href="https://t.me/SAIDULEP" target="_blank" class="font-semibold text-primary-color hover:underline">SAIDUL</a></p>
                </div>
            </div>

            <div id="admin-page" class="p-4 space-y-6 sub-page">
                <h2 class="text-2xl font-bold text-center text-gray-800">Admin Panel</h2>
                <div class="premium-card space-y-4">
                     <h3 class="font-semibold text-lg">Add New Mails</h3>
                    <p class="text-sm text-gray-500">‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü: <code class="bg-gray-200 p-1 rounded-md">email|pass|token|id</code></p>
                    <div><label for="mail-type-select" class="block text-sm font-medium text-gray-600 mb-1">Mail Type</label><select id="mail-type-select" class="w-full input-field"></select></div>
                    <div><label for="mail-data-textarea" class="block text-sm font-medium text-gray-600 mb-1">Mail Data (one per line)</label><textarea id="mail-data-textarea" rows="10" placeholder="mail@example.com|password|refresh_token|client_id" class="w-full input-field font-mono text-xs"></textarea></div>
                    <button id="add-mails-btn" class="w-full btn-gradient">Add Mails</button>
                </div>
            </div>
        </main>

        <nav class="bottom-nav">
            <a href="#" class="nav-link-premium" data-page="updates-page"><i data-lucide="bell" class="icon"></i><span class="nav-text">Updates</span></a>
            <a href="#" class="nav-link-premium" data-page="mail-page"><i data-lucide="mail" class="icon"></i><span class="nav-text">Mail</span></a>
            <a href="#" class="nav-link-premium center-home-link" data-page="home-page"><i data-lucide="home" class="icon"></i></a>
            <a href="#" class="nav-link-premium" data-page="tutorial-page"><i data-lucide="play-circle" class="icon"></i><span class="nav-text">Tutorial</span></a>
            <a href="#" class="nav-link-premium" data-page="profile-page"><i data-lucide="user" class="icon"></i><span class="nav-text">Profile</span></a>
            <a href="#" id="admin-nav-link" class="nav-link-premium hidden" data-page="admin-page"><i data-lucide="shield" class="icon"></i></a>
        </nav>
    </div>
    
    <div id="custom-alert" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm text-center shadow-xl">
            <p id="alert-message" class="mb-6 whitespace-pre-wrap text-gray-700"></p>
            <button id="alert-ok-btn" class="btn-gradient w-full">OK</button>
        </div>
    </div>
    <div id="deposit-details-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm space-y-4 text-gray-800">
            <h3 class="text-xl font-bold text-center text-accent-gradient mb-4">How to Deposit</h3>
            <div class="text-gray-600 space-y-3">
                <p>‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®:</p>
                <ol class="list-decimal list-inside space-y-2 text-sm">
                    <li>‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ø‡ßá ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶ö‡¶æ‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶®‡¶ó‡¶¶, ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂) ‡¶∏‡ßá‡¶ü‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</li>
                    <li>‡¶è‡¶∞‡¶™‡¶∞ ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶ø‡¶§ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ô‡ßç‡¶ñ‡¶ø‡¶§ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡•§</li>
                    <li>‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶™‡¶∞, ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶´‡¶∞‡ßç‡¶Æ‡¶ü‡¶ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</li>
                    <li>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ, ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£, ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶è‡¶¨‡¶Ç Transaction ID (TxID) ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§</li>
                    <li>‡¶∏‡¶¨‡¶∂‡ßá‡¶∑‡ßá "Submit Deposit" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</li>
                </ol>
                <p class="text-xs text-gray-500 mt-4">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§</p>
            </div>
            <button id="deposit-details-ok-btn" class="w-full btn-gradient mt-4">Got It!</button>
        </div>
    </div>
    
    <div id="video-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[60] p-4 backdrop-blur-sm">
        <div class="bg-black rounded-2xl w-full max-w-md shadow-xl relative aspect-video">
            <button id="video-modal-close" class="absolute -top-3 -right-3 z-10 bg-white rounded-full p-1 shadow-lg text-gray-700 hover:scale-110 transition-transform">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <iframe id="video-iframe" class="w-full h-full rounded-2xl" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        </div>
    </div>


    <script type="module">
        // =================================================================================
        const ADMIN_UID = "7358825471"; // <-- ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® Telegram Chat ID ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡¶ø‡¶®
        // =================================================================================

const firebaseConfig = {
  apiKey: "AIzaSyBVVPZnmrPhlYTVqWGB3reMM352UclMo4E",
  authDomain: "mail-shop-f861c.firebaseapp.com",
  databaseURL: "https://mail-shop-f861c-default-rtdb.firebaseio.com",
  projectId: "mail-shop-f861c",
  storageBucket: "mail-shop-f861c.firebasestorage.app",
  messagingSenderId: "535828972177",
  appId: "1:535828972177:web:7e7e8c023669999dd9f530"
};
        
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, serverTimestamp, query, where, getDocs, orderBy, limit, runTransaction, getCountFromServer, writeBatch, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentUserTg = null; 
        let userData = null; 
        let appConfig = {};
        
        const loader = document.getElementById('loader');
        
        const tutorials = [
            { 
                title: '‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?', 
                description: '‡¶∏‡¶π‡¶ú‡ßá‡¶á ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§',
                videoId: 'ajjEcCY4qOg', 
                thumbnailUrl: 'https://i.postimg.cc/Qd99h9x3/Green-White-Modern-How-To-Make-Money-Online-You-Tube-Thumbnail-1.png' 
            },
            { 
                title: '‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ï‡¶ø‡¶®‡¶¨‡ßá‡¶®?', 
                description: '‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶ï‡¶Ø‡¶º‡ßá‡¶ï ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶õ‡¶®‡ßç‡¶¶‡ßá‡¶∞ ‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®‡•§',
                videoId: 'VIDEO_ID_PLACEHOLDER_2', 
                thumbnailUrl: 'https://i.postimg.cc/T3Y9c3M2/Green-White-Modern-How-To-Make-Money-Online-You-Tube-Thumbnail-2.png' 
            },
            { 
                title: '‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßá‡¶á‡¶≤ ‡¶∞‡¶ø‡¶∏‡ßá‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?', 
                description: '‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ï‡¶ø‡¶®‡ßá ‡¶∞‡¶ø‡¶∏‡ßá‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶â‡¶™‡¶æ‡¶Ø‡¶º ‡¶ú‡¶æ‡¶®‡ßÅ‡¶®‡•§',
                videoId: 'VIDEO_ID_PLACEHOLDER_3',
                thumbnailUrl: 'https://i.postimg.cc/pr0v6t6g/Green-White-Modern-How-To-Make-Money-Online-You-Tube-Thumbnail.png' 
            }
        ];
        
        window.onload = async () => {
            try {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
                currentUserTg = window.Telegram.WebApp.initDataUnsafe.user;
                if (!currentUserTg) {
                    showAlert("Telegram user data not found. Please open this app from Telegram.");
                    loader.style.display = 'none';
                    return;
                }
            } catch (e) { 
                console.error("Telegram WebApp script failed to initialize.", e); 
                showAlert("Error initializing Telegram Mini App.");
                loader.style.display = 'none';
                return;
            }
            lucide.createIcons();
            setupEventListeners();
            setupBanner(); 
            
            loader.style.display = 'flex';
            await initUserSession();
            loader.style.display = 'none';
        };

        async function initUserSession() {
            if (!currentUserTg) return;

            const tgChatId = String(currentUserTg.id);
            const userRef = doc(db, "users", tgChatId);
            const userSnap = await getDoc(userRef);

            if (userSnap.exists()) {
                userData = userSnap.data();
            } else {
                const userName = `${currentUserTg.first_name || ''} ${currentUserTg.last_name || ''}`.trim() || `User ${tgChatId}`;
                userData = { 
                    tgChatId, name: userName, username: currentUserTg.username || null,
                    balance: 0, createdAt: serverTimestamp(), isBlocked: false 
                };
                await setDoc(userRef, userData);
            }

            if (userData.isBlocked) {
                showAlert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
                return; 
            }

            await fetchAppConfig();
            
            if (tgChatId === ADMIN_UID) {
                document.getElementById('admin-nav-link').classList.remove('hidden');
            }
            updateUI();
            document.getElementById('app-container').classList.remove('hidden');
            navigateTo('home-page');
        }

        async function fetchAppConfig() {
            const configRef = doc(db, "config", "main");
            const configSnap = await getDoc(configRef);
            appConfig = configSnap.exists() ? configSnap.data() : { mails: [] };
        }
        
        function updateUI() {
            if (!userData) return;
            const balance = (userData.balance || 0).toFixed(2);
            document.getElementById('balance-display').textContent = `‡ß≥${balance}`;
            document.getElementById('header-balance-display').textContent = `‡ß≥${balance}`;
        }

        function navigateTo(pageId) {
            document.querySelectorAll('.sub-page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            document.querySelectorAll('.nav-link-premium').forEach(link => {
                link.classList.toggle('active', link.dataset.page === pageId);
            });
            
            const pageLoadFunctions = {
                'pay-page': loadPaymentHistory,
                'mail-page': loadMailStore,
                'updates-page': loadUpdates,
                'admin-page': populateAdminMailTypes,
                'profile-page': loadProfilePage,
                'tutorial-page': loadTutorials,
                'home-page': () => lucide.createIcons()
            };
            if (pageLoadFunctions[pageId]) pageLoadFunctions[pageId]();
        }
        window.navigateTo = navigateTo;
        
        function setupEventListeners() {
            document.querySelectorAll('.nav-link-premium').forEach(link => link.addEventListener('click', (e) => { e.preventDefault(); navigateTo(link.dataset.page); }));
            document.getElementById('home-deposit-btn').addEventListener('click', () => navigateTo('pay-page'));
            document.getElementById('deposit-btn').addEventListener('click', handleDepositRequest);
            document.getElementById('download-history-btn').addEventListener('click', handleDownloadHistory);
            document.getElementById('deposit-details-btn').addEventListener('click', () => document.getElementById('deposit-details-modal').classList.remove('hidden'));
            document.getElementById('deposit-details-ok-btn').addEventListener('click', () => document.getElementById('deposit-details-modal').classList.add('hidden'));
            document.getElementById('add-mails-btn').addEventListener('click', handleAddMails);
            
            const videoModal = document.getElementById('video-modal');
            const videoModalClose = document.getElementById('video-modal-close');
            const videoIframe = document.getElementById('video-iframe');

            function closeVideoModal() {
                videoModal.classList.add('hidden');
                videoIframe.src = ''; 
            }

            videoModalClose.addEventListener('click', closeVideoModal);
            videoModal.addEventListener('click', (e) => {
                if (e.target === videoModal) {
                    closeVideoModal();
                }
            });
        }

        async function loadProfilePage() {
            const profilePic = document.getElementById('profile-pic');
            const avatarDiv = document.getElementById('profile-initials-avatar');
            
            if (currentUserTg) {
                if (currentUserTg.photo_url) {
                    profilePic.src = currentUserTg.photo_url;
                    profilePic.classList.remove('hidden');
                    avatarDiv.classList.add('hidden');
                } else {
                    const initials = (currentUserTg.first_name?.[0] || '') + (currentUserTg.last_name?.[0] || '');
                    document.getElementById('profile-initials').textContent = initials.toUpperCase();
                    profilePic.classList.add('hidden');
                    avatarDiv.classList.remove('hidden');
                }
                document.getElementById('profile-name').textContent = `${currentUserTg.first_name} ${currentUserTg.last_name || ''}`.trim();
                document.getElementById('profile-username').textContent = currentUserTg.username ? `@${currentUserTg.username}` : 'No Telegram Username';
                document.getElementById('profile-id').textContent = `Telegram ID: ${currentUserTg.id}`;
            }

            try {
                const depositQuery = query(collection(db, "deposits"), where("userId", "==", userData.tgChatId), where("status", "==", "approved"));
                const depositSnapshot = await getDocs(depositQuery);
                const totalDeposit = depositSnapshot.docs.reduce((sum, doc) => sum + doc.data().amount, 0);
                document.getElementById('profile-total-deposit').textContent = `‡ß≥${totalDeposit.toFixed(0)}`;

                const purchaseQuery = query(collection(db, "mail_purchases"), where("userId", "==", userData.tgChatId));
                const purchaseSnapshot = await getDocs(purchaseQuery);
                const totalSpent = purchaseSnapshot.docs.reduce((sum, doc) => sum + doc.data().cost, 0);
                document.getElementById('profile-total-spent').textContent = `‡ß≥${totalSpent.toFixed(0)}`;
                document.getElementById('profile-mails-purchased').textContent = purchaseSnapshot.size;
            } catch (error) {
                console.error("Error loading profile stats:", error);
            }
        }
        
        async function handleDepositRequest() {
            const method = document.getElementById('deposit-method').value;
            const amount = parseInt(document.getElementById('deposit-amount').value);
            const senderNumber = document.getElementById('sender-number').value.trim();
            const transactionId = document.getElementById('deposit-txid').value.trim();
            if (!method || !amount || amount <= 0 || !senderNumber || !transactionId) return showAlert("‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            
            loader.style.display = 'flex';
            try {
                const depositQuery = query(collection(db, "deposits"), where("transactionId", "==", transactionId));
                if (!(await getDocs(depositQuery)).empty) {
                    throw new Error("‡¶è‡¶á Transaction ID ‡¶¶‡¶ø‡ßü‡ßá ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
                }
                await addDoc(collection(db, "deposits"), {
                    userId: userData.tgChatId, userName: userData.name, method, amount,
                    senderNumber, transactionId, status: "pending", requestedAt: serverTimestamp()
                });
                showAlert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
                ['deposit-method', 'deposit-amount', 'sender-number', 'deposit-txid'].forEach(id => document.getElementById(id).value = '');
                loadPaymentHistory();
            } catch (error) {
                showAlert(error.message || "‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
            } finally {
                loader.style.display = 'none';
            }
        }

        async function loadPaymentHistory() {
            const historyList = document.getElementById('payment-history-list');
            historyList.innerHTML = '<p class="text-gray-500">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';
            try {
                const q = query(collection(db, "deposits"), where("userId", "==", userData.tgChatId), orderBy("requestedAt", "desc"));
                const snapshot = await getDocs(q);
                if (snapshot.empty) return historyList.innerHTML = '<p class="text-gray-500 text-center">‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>';

                historyList.innerHTML = snapshot.docs.map((doc, index) => {
                    const item = doc.data();
                    let statusColor, statusIcon, statusBg;
                    switch (item.status) {
                        case 'approved': statusColor = 'text-green-700'; statusBg = 'bg-green-100'; statusIcon = 'check-circle-2'; break;
                        case 'rejected': statusColor = 'text-red-700'; statusBg = 'bg-red-100'; statusIcon = 'x-circle'; break;
                        default: statusColor = 'text-yellow-700'; statusBg = 'bg-yellow-100'; statusIcon = 'hourglass';
                    }
                    const date = item.requestedAt ? item.requestedAt.toDate().toLocaleDateString('en-GB') : 'N/A';
                    return `<div class="bg-white p-4 rounded-xl flex items-center justify-between shadow-sm animate-on-load" style="animation-delay: ${index * 50}ms">
                                <div class="flex items-center gap-4">
                                    <div class="w-10 h-10 flex items-center justify-center rounded-full ${statusBg}">
                                        <i data-lucide="${statusIcon}" class="w-5 h-5 ${statusColor}"></i>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-800">${item.method} Deposit</p>
                                        <p class="text-xs text-gray-500">${date}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-lg text-gray-800">‡ß≥${item.amount}</p>
                                    <p class="font-semibold ${statusColor} capitalize text-xs">${item.status}</p>
                                </div>
                            </div>`;
                }).join('');
                lucide.createIcons();
            } catch (error) {
                historyList.innerHTML = '<p class="text-red-500 text-center">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>';
            }
        }

        async function getStockCount(collectionName) {
            const q = query(collection(db, collectionName), where("isSold", "==", false));
            const snapshot = await getCountFromServer(q);
            return snapshot.data().count;
        }

        async function loadMailStore() {
            const mailListEl = document.getElementById('mail-list');
            const historyListEl = document.getElementById('mail-purchase-history');
            mailListEl.innerHTML = '<p class="text-center text-gray-500">‡¶Æ‡ßá‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';
            historyListEl.innerHTML = '<p class="text-center text-gray-500">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';
            
            try {
                const stockPromises = (appConfig.mails || []).map(mail => getStockCount(mail.stockKey));
                const stockCounts = await Promise.all(stockPromises);
                
                let mailsWithStock = (appConfig.mails || []).map((mail, index) => ({ ...mail, stock: stockCounts[index] })).sort((a, b) => b.stock - a.stock);

                mailListEl.innerHTML = mailsWithStock.map((mail, index) => {
                    const isOutOfStock = mail.stock === 0;
                    const insufficientBalance = userData.balance < mail.priceBdt;
                    return `<div class="premium-card space-y-3 animate-on-load" style="animation-delay: ${index * 70}ms">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-3"><img src="${mail.logoUrl}" class="w-10 h-10 rounded-lg object-cover" alt="${mail.type} logo"><h3 class="font-bold text-lg text-gray-800">${mail.type}</h3></div>
                                <span class="text-xs font-bold ${mail.stock > 0 ? 'text-green-600 bg-green-100' : 'text-red-600 bg-red-100'} px-3 py-1 rounded-full">Stock: ${mail.stock}</span>
                            </div>
                            <div class="grid grid-cols-2 text-center items-center pt-3 border-t">
                                <div><p class="text-gray-500 text-sm">Price</p><p class="font-bold text-xl text-accent-gradient">‡ß≥${mail.priceBdt.toFixed(2)}</p></div>
                                <div><p class="text-gray-500 text-sm">Details</p><button onclick="showMailDetails('${mail.type}', '${mail.details.replace(/'/g, "\\'")}')" class="font-semibold text-blue-500">View</button></div>
                            </div>
                            <button class="${isOutOfStock || insufficientBalance ? 'btn-disabled' : 'btn-gradient'} w-full mt-2" ${isOutOfStock || insufficientBalance ? 'disabled' : ''} onclick="buyMail('${mail.type}', ${mail.priceBdt}, '${mail.stockKey}')">Buy Now</button>
                        </div>`;
                }).join('');
                
                const q = query(collection(db, "mail_purchases"), where("userId", "==", userData.tgChatId), orderBy("purchasedAt", "desc"));
                const querySnapshot = await getDocs(q);
                if(querySnapshot.empty) {
                    historyListEl.innerHTML = '<p class="text-center text-gray-500">‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ï‡¶ø‡¶®‡ßá‡¶®‡¶®‡¶ø‡•§</p>';
                } else {
                     historyListEl.innerHTML = querySnapshot.docs.map((doc, index) => {
                        const purchase = doc.data();
                        return `<div class="bg-white p-4 rounded-xl shadow-sm animate-on-load" style="animation-delay: ${index*50}ms">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="font-bold text-gray-800">${purchase.mailType}</p>
                                            <p class="text-sm font-mono text-gray-600 break-all">${purchase.mail}</p>
                                            ${purchase.password ? `<p class="text-sm font-mono text-gray-600 break-all">${purchase.password}</p>` : ''}
                                            <p class="text-xs text-gray-400 mt-2">${purchase.purchasedAt.toDate().toLocaleString()}</p>
                                        </div>
                                        <button onclick="copyToClipboard('${purchase.mail} ${purchase.password || ''}', this)" class="text-gray-400 hover:text-primary-color p-2"><i data-lucide="copy" class="w-4 h-4"></i></button>
                                    </div>
                                </div>`;
                    }).join('');
                }
                lucide.createIcons();
            } catch(e) {
                 mailListEl.innerHTML = '<p class="text-center text-red-500">‡¶Æ‡ßá‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>';
                 console.error(e);
            }
        }
        
        window.buyMail = async function(mailType, cost, stockKey) {
            if (userData.balance < cost) return showAlert(`‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶® ‡ß≥${cost.toFixed(2)}‡•§`);
            if (!confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡ß≥${cost.toFixed(2)} ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ${mailType} ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`)) return;

            loader.style.display = 'flex';
            try {
                const purchasedMailData = await runTransaction(db, async (transaction) => {
                    const q = query(collection(db, stockKey), where("isSold", "==", false), limit(1));
                    const mailDoc = (await getDocs(q)).docs[0];
                    if (!mailDoc) throw new Error("‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶á ‡¶ß‡¶∞‡¶®‡ßá‡¶∞ ‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶∏‡ßç‡¶ü‡¶ï ‡¶∂‡ßá‡¶∑‡•§");
                    
                    const userRef = doc(db, "users", userData.tgChatId);
                    const userSnap = await transaction.get(userRef);
                    if (!userSnap.exists() || userSnap.data().balance < cost) throw new Error(`‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡•§`);

                    transaction.update(userRef, { balance: userSnap.data().balance - cost });
                    transaction.update(mailDoc.ref, { isSold: true, soldTo: userData.tgChatId, soldAt: serverTimestamp() });
                    transaction.set(doc(collection(db, "mail_purchases")), { userId: userData.tgChatId, mailType, mail: mailDoc.data().email, password: mailDoc.data().password || null, cost, purchasedAt: serverTimestamp() });
                    return mailDoc.data();
                });

                userData.balance -= cost; 
                updateUI();
                showAlert(`‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡ßá‡¶®‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!\n\nEmail: ${purchasedMailData.email}\nPassword: ${purchasedMailData.password || 'N/A'}`);
                loadMailStore(); 
            } catch (e) { showAlert(e.message || "‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"); } 
            finally { loader.style.display = 'none'; }
        }
        
        function loadTutorials() {
            const listEl = document.getElementById('tutorial-list');
            if (!listEl) return;
            
            listEl.innerHTML = tutorials.map((tutorial, index) => `
                <div class="tutorial-card animate-on-load" data-video-id="${tutorial.videoId}" style="animation-delay: ${index * 70}ms">
                    <div class="thumbnail-container">
                        <img src="${tutorial.thumbnailUrl}" alt="${tutorial.title}">
                        <div class="play-icon">
                            <i data-lucide="play" class="w-6 h-6 ml-1"></i>
                        </div>
                    </div>
                    <div class="tutorial-info">
                        <h3 class="text-lg">${tutorial.title}</h3>
                        <p>${tutorial.description}</p>
                    </div>
                </div>
            `).join('');
            
            document.querySelectorAll('.tutorial-card').forEach(card => {
                card.addEventListener('click', () => {
                    const videoId = card.dataset.videoId;
                    if (videoId && !videoId.includes('PLACEHOLDER')) {
                        const iframe = document.getElementById('video-iframe');
                        iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                        document.getElementById('video-modal').classList.remove('hidden');
                    } else {
                        showAlert('‡¶è‡¶á ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶ü‡¶ø ‡¶è‡¶ñ‡¶®‡¶ì ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§');
                    }
                });
            });
            lucide.createIcons();
        }

        async function handleDownloadHistory() {
            loader.style.display = 'flex';
            try {
                const q = query(collection(db, "mail_purchases"), where("userId", "==", userData.tgChatId), orderBy("purchasedAt", "desc"));
                const querySnapshot = await getDocs(q);
                if (querySnapshot.empty) throw new Error("‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§");
                
                const dataForExcel = querySnapshot.docs.map(doc => {
                    const p = doc.data();
                    return { 'Date': p.purchasedAt.toDate().toLocaleString(), 'Type': p.mailType, 'Email': p.mail, 'Password': p.password || 'N/A', 'Cost': p.cost };
                });
                
                const worksheet = XLSX.utils.json_to_sheet(dataForExcel);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, "Purchase History");
                worksheet['!cols'] = [ {wch: 22}, {wch: 20}, {wch: 30}, {wch: 30}, {wch: 15} ];
                XLSX.writeFile(workbook, `Purchase_History_${userData.name}.xlsx`);
            } catch (error) { showAlert(error.message); } 
            finally { loader.style.display = 'none'; }
        }

        async function loadUpdates() {
            const updatesContainer = document.getElementById('updates-content');
            updatesContainer.innerHTML = '<p class="text-center text-gray-500">Loading updates...</p>';
            try {
                const q = query(collection(db, "updates"), orderBy("createdAt", "desc"), limit(1));
                const snapshot = await getDocs(q);
                if (snapshot.empty) return updatesContainer.innerHTML = `<div class="premium-card text-center"><h3 class="font-bold text-xl">No new updates!</h3><p class="text-gray-500 mt-2">Check back later.</p></div>`;
                
                const updateData = snapshot.docs[0].data();
                updatesContainer.innerHTML = `<div class="premium-card overflow-hidden">
                    <img src="${updateData.imageUrl}" class="w-full h-48 object-cover mb-4" alt="Update Banner">
                    <div class="px-2 space-y-3">
                        <h3 class="text-xl font-bold text-gray-800">${updateData.title}</h3>
                        <p class="text-gray-600 text-sm whitespace-pre-wrap">${updateData.content || ''}</p>
                        ${updateData.linkUrl ? `<a href="${updateData.linkUrl}" target="_blank" class="btn-gradient w-full block text-center mt-4">Learn More</a>` : ''}
                    </div>
                </div>`;
                lucide.createIcons();
            } catch(e) { 
                updatesContainer.innerHTML = `<p class="text-center text-red-500">Failed to load updates.</p>`; 
            }
        }
        
        function populateAdminMailTypes() {
            const selectEl = document.getElementById('mail-type-select');
            selectEl.innerHTML = '<option value="">Select mail type...</option>';
            (appConfig.mails || []).forEach(mail => {
                selectEl.innerHTML += `<option value="${mail.stockKey}">${mail.type}</option>`;
            });
        }

        async function handleAddMails() {
            const stockKey = document.getElementById('mail-type-select').value;
            const mailDataRaw = document.getElementById('mail-data-textarea').value;
            if (!stockKey || !mailDataRaw.trim()) return showAlert("Please select a mail type and provide mail data.");
            
            const lines = mailDataRaw.trim().split('\n').filter(line => line.trim() !== '' && line.includes('|'));
            if (lines.length === 0) return showAlert("No valid mail data found.");
            
            loader.style.display = 'flex';
            try {
                const batch = writeBatch(db);
                lines.forEach(line => {
                    const parts = line.trim().split('|');
                    if (parts.length === 4) {
                        const mailDocRef = doc(collection(db, stockKey));
                        batch.set(mailDocRef, { 
                            email: parts[0], password: parts[1], refresh_token: parts[2], client_id: parts[3], 
                            isSold: false, createdAt: serverTimestamp() 
                        });
                    }
                });
                await batch.commit();
                showAlert(`Successfully added ${lines.length} new mails.`);
                document.getElementById('mail-data-textarea').value = '';
            } catch (error) { 
                showAlert("An error occurred while adding mails."); 
            } finally { 
                loader.style.display = 'none'; 
            }
        }

        function showAlert(message) {
            document.getElementById('alert-message').innerText = message;
            document.getElementById('custom-alert').classList.remove('hidden');
            document.getElementById('alert-ok-btn').onclick = () => document.getElementById('custom-alert').classList.add('hidden');
        }
        
        window.showMailDetails = (type, details) => showAlert(`${type} Details\n\n${details}`);

        window.copyToClipboard = function(text, element) {
            navigator.clipboard.writeText(text.trim()).then(() => {
                if(element) {
                    const originalIcon = element.innerHTML;
                    element.innerHTML = `<i data-lucide="check" class="w-4 h-4 text-green-500"></i>`;
                    lucide.createIcons();
                    setTimeout(() => { element.innerHTML = originalIcon; lucide.createIcons(); }, 1500);
                } else showAlert('‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            });
        }

        function setupBanner() {
            const slides = document.querySelectorAll('.slide');
            const slideContainer = document.getElementById('slides');
            const dotsContainer = document.getElementById('dots');
            if (slides.length <= 1) return;
            let index = 0;
            dotsContainer.innerHTML = Array.from(slides).map((_, i) => `<span class="dot ${i === 0 ? 'active' : ''}" data-index="${i}"></span>`).join('');
            const dots = dotsContainer.querySelectorAll('.dot');
            const showSlide = (i) => {
                index = i;
                slideContainer.style.transform = `translateX(${-i * 100}%)`;
                dots.forEach(d => d.classList.remove('active'));
                dots[i]?.classList.add('active');
            };
            dotsContainer.addEventListener('click', e => { if(e.target.matches('.dot')) showSlide(parseInt(e.target.dataset.index)); });
            setInterval(() => showSlide((index + 1) % slides.length), 5000);
        }
    </script>
</body>
</html>
